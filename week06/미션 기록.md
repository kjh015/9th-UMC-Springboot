# 미션 기록

# **내가 작성한 리뷰 보기 API**

- 필터링 조건: 가게별(반이학생마라탕마라반), 별점별 (5점, 4점대, 3점대 …)

```java
@RestController
@RequiredArgsConstructor
public class ReviewController {
    private final ReviewQueryService reviewQueryService;    

    @GetMapping("/reviews/members/{memberId}")
    public List<Review> memberReviews(@PathVariable String memberId, @RequestParam String query, @RequestParam String type) {
        List<Review> result = reviewQueryService.memberReviews(Long.parseLong(memberId), query, type);
        return result;

    }
}
```

```java
@Service
@RequiredArgsConstructor
public class ReviewQueryService {
    private final ReviewRepository reviewRepository;    

    public List<Review> memberReviews(Long memberId, String query, String type) {
        QReview review = QReview.review;
        QStore store = QStore.store;

        BooleanBuilder builder = new BooleanBuilder();

        if(type.equals("store")){
            builder.and(store.name.eq(query));
        }
        if(type.equals("star")){
            builder.and(review.star.goe(Float.parseFloat(query)));
            builder.and(review.star.lt(Float.parseFloat(query) + 1.0));
        }
        if(type.equals("both")){
            String firstQuery = query.split("&")[0];
            String secondQuery = query.split("&")[1];

            builder.and(store.name.eq(firstQuery));
            builder.and(review.star.goe(Float.parseFloat(secondQuery)));
            builder.and(review.star.lt(Float.parseFloat(secondQuery) + 1.0));

        }

        builder.and(review.member.id.eq(memberId));

        List<Review> reviewList = reviewRepository.memberReviews(builder);
        return reviewList;
    }
}
```

```java
@Service
@RequiredArgsConstructor
public class ReviewQueryDSLImpl implements ReviewQueryDSL {

    private final EntityManager em;    

    @Override
    public List<Review> memberReviews(Predicate predicate){
        JPAQueryFactory queryFactory = new JPAQueryFactory(em);

        QReview review = QReview.review;
        QStore store = QStore.store;

        return queryFactory
                .selectFrom(review)
                .join(store).on(store.id.eq(review.store.id))
                .where(predicate)
                .fetch();
    }

}
```